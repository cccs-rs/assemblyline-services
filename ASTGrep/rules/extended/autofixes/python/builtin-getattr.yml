# yaml-language-server: $schema=https://raw.githubusercontent.com/ast-grep/ast-grep/main/schemas/rule.json

id: python-builtin-getattr
message: Uses getattr to obfuscate using a builtin function
language: Python
rule:
  any:
    - pattern: getattr(__import__($BUILTINS), "$DATA")
    - pattern: getattr(__import__($BUILTINS), '$DATA')
    - pattern: getattr(__import__($BUILTINS), b'$DATA')
    - pattern: getattr(__import__($BUILTINS), b"$DATA")
    - pattern: getattr(__import__($BUILTINS), b'''$DATA''')
    - pattern: getattr(__import__($BUILTINS), b"""$DATA""")
    - pattern: getattr(__import__($BUILTINS), '''$DATA''')
    - pattern: getattr(__import__($BUILTINS), """$DATA""")
    - pattern: getattr(builtins, '$DATA')
    - pattern: getattr(builtins, "$DATA")
    - pattern: getattr(builtins, b'$DATA')
    - pattern: getattr(builtins, b"$DATA")
    - pattern: getattr(builtins, b'''$DATA''')
    - pattern: getattr(builtins, b"""$DATA""")
    - pattern: getattr(builtins, '''$DATA''')
    - pattern: getattr(builtins, """$DATA""")

fix: $DATA

constraints:
  BUILTINS:
    kind: string
    regex: "[Bb]?[\"']+builtins[\"']+"


metadata:
  extended-obfuscation: yes
  confirmed-obfuscation: yes

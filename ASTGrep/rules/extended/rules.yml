# yaml-language-server: $schema=https://raw.githubusercontent.com/ast-grep/ast-grep/main/schemas/rule.json
# YAML Rule is more powerful!

# https://ast-grep.github.io/guide/rule-config.html#rule

id: obfuscation-fernet-2
language: Python
rule:
  any:
    - pattern: Fernet($PASS).decrypt($DATA)
    - pattern:
        context: $X.decrypt($DATA)
        selector: expression_statement
      follows:
        pattern:
          context: $X = Fernet($PASS)
          selector: expression_statement
        # stopby: end
        # selector: expression_statement
    # - pattern: $X = Fernet($PASS)
    - pattern: print($A)
      # kind: expression_statement
      follows:
        pattern: print($$$)
        # kind: expression_statement
        # stopby: end